<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 7 页 | 平凡之路</title>
  <meta name="author" content="chaofan.cui">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="平凡之路"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="平凡之路" type="application/atom+xml">
  
  
    <link href="/favicon.ico" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?9fa039175166f0b0f6d5d0bcfe1fd18b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

 <body>  
  <nav id="main-nav" class="navbar  navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">平凡之路</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="所有文章">
			  <i class="fa fa-archive"></i>文章
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="所有分类">
			  <i class="fa fa-folder"></i>分类
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="所有标签">
			  <i class="fa fa-tags"></i>标签
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="关于我">
			  <i class="fa fa-user"></i>关于
			</a>
		  </li>
		  
		  <li>
			<a href="/message" title="All the tags.">
			  <i class="fa fa-pencil"></i>给我留言
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="RSS">
			  <i class="fa fa-rss-square"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header ">
  <h1 class="title ">coding</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      stay hungry,stay foolish
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-08-16 </div>
			<div class="article-title"><a href="/2015/08/16/2015-08-16-for-foreach/" >for vs foreach</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h5 id="&#x7FFB;&#x5899;&#x51FA;&#x53BB;&#xFF0C;&#x627E;&#x5230;&#x7684;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x3002;&#x6BD4;&#x8F83;&#x597D;&#xFF0C;&#x968F;&#x624B;&#x5C31;copy_&#x5206;&#x4EAB;&#x7ED9;&#x5927;&#x5BB6;&#x3002;&#x82F1;&#x6587;&#x4E0D;&#x597D;&#x7684;_&#x8BF7;&#x7565;&#x8FC7;&#x2026;">&#x7FFB;&#x5899;&#x51FA;&#x53BB;&#xFF0C;&#x627E;&#x5230;&#x7684;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x3002;&#x6BD4;&#x8F83;&#x597D;&#xFF0C;&#x968F;&#x624B;&#x5C31;copy &#x5206;&#x4EAB;&#x7ED9;&#x5927;&#x5BB6;&#x3002;&#x82F1;&#x6587;&#x4E0D;&#x597D;&#x7684;  &#x8BF7;&#x7565;&#x8FC7;&#x2026;</h5><p>For vs. Foreach. For and foreach differ slightly in performance. They are approximately the same speed. But the foreach loop uses more stack space for local variables. In this comparison, we strive to understand the exact difference in the two loops.</p>
<p>Comparison. First, let&#x2019;s look at the version of the loop that uses the for loop (Method1) and the version that uses the foreach-loop (Method2). Each method sums all the elements in an integer array.<br><strong>For loop version: Method1</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Method1</span>(<span class="params"><span class="keyword">int</span>[] array</span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.Length; i++)</span><br><span class="line">    {</span><br><span class="line">	a += array[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><strong>Foreach loop version: Method2</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Method2</span>(<span class="params"><span class="keyword">int</span>[] array</span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">int</span> <span class="keyword">value</span> <span class="keyword">in</span> array)</span><br><span class="line">    {</span><br><span class="line">	a += <span class="keyword">value</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>Difference. In .NET 4.0, we see a difference in the IL. The Method1 version uses enough stack space for only two local variables (a and i). The Method2 version uses stack space for four locals (a, value, and two compiler-generated temporaries).<br>IL<br>When a method is called in the Common Language Runtime, all of the memory required for the locals is allocated upon the stack. Because this takes place on the stack, this process is fast, but it is not free.<br>Thus:The foreach-loop will incur a small cost due to its extra two local variables.</p>
<p>Benchmark. Now, let&#x2019;s test these two methods against each other. When testing, try altering the order of the methods such that Method2 is tested before Method1. You will need to paste Method1 and Method2 into the Program class.<br>Note:The foreach version was slower than the for version. This is because the foreach-version uses more local variable space.<br><strong>C# program that benchmarks methods</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span><br><span class="line">    </span>{</span><br><span class="line">	<span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[] { <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span> };</span><br><span class="line">	Method1(array);</span><br><span class="line">	Method2(array);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> s1 = Stopwatch.StartNew();</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> m = <span class="number">100000000</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">	{</span><br><span class="line">	    Method1(array);</span><br><span class="line">	}</span><br><span class="line">	s1.Stop();</span><br><span class="line">	<span class="keyword">var</span> s2 = Stopwatch.StartNew();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">	{</span><br><span class="line">	    Method2(array);</span><br><span class="line">	}</span><br><span class="line">	s2.Stop();</span><br><span class="line">	Console.WriteLine(((<span class="keyword">double</span>)(s1.Elapsed.TotalMilliseconds *</span><br><span class="line">	    <span class="number">1000000</span>) / m).ToString(<span class="string">&quot;0.00 ns&quot;</span>));</span><br><span class="line">	Console.WriteLine(((<span class="keyword">double</span>)(s2.Elapsed.TotalMilliseconds *</span><br><span class="line">	    <span class="number">1000000</span>) / m).ToString(<span class="string">&quot;0.00 ns&quot;</span>));</span><br><span class="line">	Console.Read();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><strong>Output</strong></p>
<p>7.37 ns<br>8.04 ns</p>
<p>Benchmark 2. The extra local variables in the foreach loop slow down the simple loop. However, it is possible to use those local variables to our advantage. Let&#x2019;s change the loops to have two statements that access the value.<br><strong>For loop alternate version: Method1</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Method1</span>(<span class="params"><span class="keyword">int</span>[] array</span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.Length; i++)</span><br><span class="line">    {</span><br><span class="line">	a += array[i];</span><br><span class="line">	a += array[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><strong>Foreach loop alternate version: Method2</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Method2</span>(<span class="params"><span class="keyword">int</span>[] array</span>)</span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">int</span> <span class="keyword">value</span> <span class="keyword">in</span> array)</span><br><span class="line">    {</span><br><span class="line">	a += <span class="keyword">value</span>;</span><br><span class="line">	a += <span class="keyword">value</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p><strong>Results</strong></p>
<p>7.71 ns<br>7.69 ns</p>
<p>New results. Now, the for loop is slightly slower than the foreach loop. This is because the local variable that stores the value of the element in the array is faster to access than an element in the array.</p>
<p><strong>Summary.</strong> In micro-benchmarking, introducing extra local variables with foreach-loops can impact performance. However, if those local variables are reused several times in the loop body, they can lead to a performance improvement.<br>Thus:The for-loop is faster than the foreach-loop if the array must only be accessed once per iteration.</p>

	
	</div>
  <a type="button" href="/2015/08/16/2015-08-16-for-foreach/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/page/6/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/8/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/net基础/">.net基础<span>4</span></a></li>
		
			<li><a href="/categories/sql/">sql<span>1</span></a></li>
		
			<li><a href="/categories/好文章/">好文章<span>1</span></a></li>
		
			<li><a href="/categories/编程概念/">编程概念<span>1</span></a></li>
		
			<li><a href="/categories/随笔/">随笔<span>1</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/闭包/">闭包<span>1</span></a></li>
		
			<li><a href="/tags/c/">c#<span>2</span></a></li>
		
			<li><a href="/tags/IL/">IL<span>1</span></a></li>
		
			<li><a href="/tags/随笔/">随笔<span>1</span></a></li>
		
			<li><a href="/tags/习惯/">习惯<span>1</span></a></li>
		
			<li><a href="/tags/sql/">sql<span>1</span></a></li>
		
			<li><a href="/tags/GC/">GC<span>1</span></a></li>
		
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2016/05/18/2016-05-18-test/" ><i class="fa fa-file-o"></i>test...</a>
      </li>
    
      <li>
        <a href="/2015/09/11/2015-09-11-IL解析/" ><i class="fa fa-file-o"></i>IL解析...</a>
      </li>
    
      <li>
        <a href="/2015/09/03/2015-09-03-闭包/" ><i class="fa fa-file-o"></i>闭包...</a>
      </li>
    
      <li>
        <a href="/2015/08/28/2015-08-28-10xdeveloper/" ><i class="fa fa-file-o"></i>10个习惯和10倍开发效率...</a>
      </li>
    
      <li>
        <a href="/2015/08/27/2015-08-27-sql执语句执行顺序/" ><i class="fa fa-file-o"></i>sql语句执行顺序...</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/bytes1001" title="My Github account." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="http://t.qq.com/vassili1001" title="My Linkin account." target="_blank"]);">我的微博</a></li>
	
	</ul>
</div>


		
			
<div class="widget">
  <h4>最新评论</h4>
<p class="ds-recent-comments" data-num-items="10" data-show-avatars="1" data-show-time="1" data-show-admin="1" data-excerpt-length="70">
</p>
</div>
	<script type="text/javascript">
	    var duoshuoQuery = { short_name: 'bytes1001' };
	    (function() {
	    var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
	</script>
		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2016 chaofan.cui
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
